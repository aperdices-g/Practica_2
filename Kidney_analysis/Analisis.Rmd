---
title: "Práctica 2. Tipologia de Datos. Análisis y Visualización"
author: "Nuria Garcia y Alicia Perdices"
date: "03/06/2020"
output:
  html_document:
    number_sections: no
    toc: yes
  pdf_document:
    toc: yes
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# **PRÁCTICA 2:** 

# ***0.-Librerias necesarias***

Abrimos las librerías necesarias para el buen funcionamiento de la práctica.

```{r}
library(readr)
library(PerformanceAnalytics)
library(ggplot2)
library("gridExtra")
```

# ***1.-Descripción del dataset. ¿Por qué es importante y qué pregunta/problema pretende responder?***

El dataset objeto de estudio se ha obtenido a partir del siguiente enlace https://www.kaggle.com/mansoordaku/ckdisease en la web de Kaggle.Consta de 400 registros y 25 variables (25+Id) con información sobre pacientes del hospital Apollo en Tamil Nadu, estado del sur de la India, tanto con enfermedad renal crónica como no (determinados por el campo class).

La enfermedad renal crónica es un problema de salud global que crece constantemente, según nos indica el World Kidney Day (https://www.worldkidneyday.org/), actualmente afecta a 850 millones de personas, es decir, 1 de cada 10 adultos padecen esta enfermedad. El estudio de estos datos a través de la minería de datos puede ayudar a la detección precoz de dicha enfermedad (evitando una gravedad en el paciente), a realizar un mejor diagnóstico ayudando así a una mejor implementación de los tratamientos, y  en los gastos sanitarios (evitando la cronificación se reducen los gastos derivados de un empeoramiento de la enfermedad)*.

Por tanto, este conjunto de datos nos va a servir para predecir qué pacientes tienen más probabilidades de desarrollar una insuficiencia renal crónica a partir de parámetros como la edad, recuento de células en sangre (bioquímica básica) y ciertos aspectos como la presencia o no de diabetes, hipertensión, afecciones cardíacas etc.

El dataset se compone de los siguientes parámetros:

*	*Id*: (Numerical):Identificador
*	*Age* (Numerical): age in years
*	*bp* (Numerical): Blood presure(bp in mm/Hg)
*	*sp*: Specific Gravity(nominal).sg - (1.005,1.010,1.015,1.020,1.025)
*	*al*: Albumin(nominal):al - (0,1,2,3,4,5)
* *su*: Sugar(nominal):su - (0,1,2,3,4,5)
* *rbc*: Red Blood Cells(nominal):rbc - (normal,abnormal)
* *pc*: Pus Cell (nominal):pc - (normal,abnormal)
*	*pcc*: Pus Cell clumps(nominal):pcc - (present,notpresent)
*	*ba*: Bacteria(nominal):ba - (present,notpresent)
*	*bgr*: Blood Glucose Random(numerical):bgr in mgs/dl
*	*bu*: Blood Urea(numerical):bu in mgs/dl
*	*sc*: Serum Creatinine(numerical):sc in mgs/dl
*	*sod*: Sodium(numerical):sod in mEq/L
*	*pot*: Potassium(numerical):pot in mEq/L
*	*hemo*: Hemoglobin(numerical:hemo in gms
*	*pcv*: Packed Cell Volume(numerical)
*	*wc*: White Blood Cell Count(numerical):wc in cells/cumm
*	*rc*: Red Blood Cell Count(numerical):rc in millions/cmm
*	*htn*: Hypertension(nominal):htn - (yes,no)
*	*dm*: Diabetes Mellitus(nominal):dm - (yes,no)
*	*cad*: Coronary Artery Disease(nominal):cad - (yes,no)
*	*appet*: Appetite(nominal):appet - (good,poor)
*	*pe*: Pedal Edema(nominal):pe - (yes,no)
*	*ane*: Anemia(nominal):ane - (yes,no)
*	*classification*: Class (nominal):class - (ckd,notckd)


* Para más información del impacto del análisis de los datos en este tipo de datos recomendamos el artículo 'Informatics in Medicine Unlocked' (https://www.sciencedirect.com/science/article/pii/S2352914818302387)

# ***2.-Integración y selección de los datos de interés a analizar***

Realizamos carga de los datos para su análisis (utilizamos el fichero kidney_disease_clean_2.csv que se ha obtenido en Kidey_disease_cleaning_2.Rmd después de la limpieza del fichero original):

```{r}
datos<-read.csv("data/kidney_disease_clean_2.csv",sep=",",header = TRUE)
head(datos)
```

Veamos la estructura de los datos cargados:

```{r}
str(datos)
```

Como ya se ha comentado partimos de 400 registros donde tenemos: 250 registros de pacientes con enfermedad renal crónica y 150 registros de pacientes que no presentan enfermedad renal.

```{r}
table(datos$classification)
```


Para poder deducir qué factores son los más determinantes a la hora de desarrollar una enfermedad como la insuficiencia renal crónica, contaremos con todos los atributos del dataset una vez completada la fase de limpieza correspondiente.Tan solo prescindiremos del campo Id que es simplemente identificativo del registro y no nos aporta información al estudio.

# ***3.-Limpieza de datos***

## ***3.1-¿Los datos contienen ceros o elementos vacios?¿Como gestionarías cada uno de estos casos?***
  
  Todos los atributos del dataset, contienen elementos vacíos. La cantidad de valores nulos identificados en los campos es el siguiente:
  
  *	*Id*: No presenta valores nulos ni vacíos.
  *	*Age*: 9 valores nulos.
  *	*bp*: 12 valores nulos.
  *	*sp*: 47 valores vacíos.
  *	*al*: 46 valores vacíos.
  * *su*: 49 valores vacíos.
  * *rbc*: 152 valores vacíos.
  * *pc*: 65 valores vacíos.
  *	*pcc*: 4 valores vacíos.
  *	*ba*: 4 valores vacíos.
  *	*bgr*: 44 valores nulos.
  *	*bu*: 19 valores nulos.
  *	*sc*: 17 valores nulos.
  *	*sod*: 87 valores nulos.
  *	*pot*: 88 valores nulos.
  *	*hemo*: 52 valores nulos.
  *	*pcv*: 71 valores nulos.
  *	*wc*: 106 valores nulos.
  *	*rc*: 131 valores nulos.
  *	*htn*: 2 valores vacíos.
  *	*dm*: 2 valores vacíos y 5 valores mal identificados.
  *	*cad*: 2 valores vacíos y 2 valores mal identificados.
  *	*appet*: 1 valor vacío.
  *	*pe*: 1 valor vacío.
  *	*ane*: 1 valor vacío.
  *	*classification*: 2 valores mal identificados.
  
  
* En primer lugar, se ha transformado los valores de todas las columnas al tipo de datos correcto, además de corregir las categorías establecidas en las variables cualitativas.
  
* Los elementos vacíos se han gestionado de dos formas
    
    * **Método 1**.Para las variables categóricas, se han sustituido por la clase más frecuente. Y para las variables numéricas,  por la media del atributo en cuestión. Al final del proceso, hemos  obtenido el archivo **kidney_disease_clean_1.csv.(Kidey_disease_cleaning.Rmd)**
    
    * **Método 2**.Para las variables categóricas, se han sustituido por la clase más frecuente al igual que en el método anterior. Pero en este caso, para los elemenos vacíos de las variables numéricas, se ha utilizado el algoritmo KNN, de los vecinos más cercanos, para imputar estos valores.Al final del proceso. Además se ha realizado estudio de valores atípicos. Como resultado se ha obtenido el archivo **kidney_disease_clean_2.csv. (Kidey_disease_cleaning_2.Rmd)**
  


## ***3.2-Identificación y tratamiento de valores extremos***

Los valores extremos se han identificado mediante diagramas de cajas.Se han tratado en el apartado de limpieza reemplazando solo aquellos no compatibles con la realidad de la enfermedad.
El resto de outliers es importante conservarlos, ya que pueden condicionar que una enfermedad renal crónica sea diagnosticada correctamente o no.

Realizaremos un breve analisis de los diagramas de cajas, visualizando las características de los pacientes que tienen diagnosticado la enfermedad crónica (etiquetados como ckd) y los que no la tienen (etiquetados como notckd). Recordamos que en **Kidey_disease_cleaning_2.Rmd** se ha realizado un previo estudio donde algunos valores extremos han sido tratados y substituidos por la imputación utilizada en dicho 'cleaning'.

Nota: la distinción de color solo indica la dos clases: ckd (pacientes con enfermedad crónica) serán amarillos y notckd (pacientes sin enfermedad) serán verdes.

### **DIAGRAMAS DE CAJAS**

```{r}
par(mfrow=c(1,2))
boxplot(datos$bp ~ datos$classification,col = c("yellow", "green"), 
                          xlab="Classification", ylab="Bp", main='Blood Pressure',)
legend("topright", legend=c("ckd", "notckd"), c("yellow", "green"), title="Class", fill=c("yellow", "green"), cex=0.8)

boxplot(datos$bgr ~ datos$classification,col = c("yellow", "green"),
                      xlab="Classification", ylab="Bgr",main='Blood Glucose Random')
legend("topright", legend=c("ckd", "notckd"), col=c("yellow", "green"), title="Class", fill=c("yellow", "green"), cex=0.8)
```

Observamos que los pacientes diagnosticados tienen valores más altos que los pacientes sin la enfermedad. Además se obtienen valores fuera de los normal. Tanto en presión sanguínea como en glucosa, la media está por encima de los valores normales.

Los valores extremos encontrados en las varibles, considerándolas en su globalidad, son:

```{r}
par(mfrow=c(1,2))
boxplot(datos$bp,main='Blood Pressure')
boxplot(datos$bgr,main='Blood Glucose Random')

values_bp<-boxplot.stats(datos$bp)$out
cat("Valores extremos de Blood Pressure :", toString(values_bp), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_bp, dnn = "Count values_bp:")  

values_bgr<-boxplot.stats(datos$bgr)$out
cat("Valores extremos de Blood Glucose Random :",toString(values_bgr), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_bgr, dnn = "Count values_bgr:")
```

```{r}
par(mfrow=c(1,2))
boxplot(datos$sc ~ datos$classification,col = c("yellow", "green"), 
                          xlab="Classification", ylab="sc", main='Serum Creatinine',)
legend("topright", legend=c("ckd", "notckd"), c("yellow", "green"), title="Class", fill=c("yellow", "green"), cex=0.8)

boxplot(datos$sod ~ datos$classification,col = c("yellow", "green"),
                      xlab="Classification", ylab="Sod",main='Sodium')
legend("topright", legend=c("ckd", "notckd"), col=c("yellow", "green"), title="Class", fill=c("yellow", "green"), cex=0.8)
```

Los valores de Creatinina son mucho más altos en los pacientes con enfermedad. El Sodio mantienen, en general, una media más baja que pacientes diagnosticados.También vemos algún valor alterado superior.

Los valores extremos encontrados en las varibles, considerándolas en su globalidad, son:

```{r}
par(mfrow=c(1,2))
boxplot(datos$sc,main='Serum Creatinine')
boxplot(datos$sod,main='Sodium')

values_sc<-boxplot.stats(datos$sc)$out
cat("Valores extremos de Serum Creatinine :",toString(values_sc), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_sc, dnn = "Count values_sc:")  

values_sod<-boxplot.stats(datos$sod)$out
cat("Valores extremos de Sodium :",toString(values_sod), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_sod, dnn = "Count values_sod:")
```


```{r}
par(mfrow=c(1,2))
boxplot(datos$pot ~ datos$classification,col = c("yellow", "green"), 
                          xlab="Classification", ylab="pot", main='Potassium',)

legend("topright", legend=c("ckd", "notckd"), c("yellow", "green"), 
       title="Class", fill=c("yellow", "green"), cex=0.8)

boxplot(datos$hemo ~ datos$classification,col = c("yellow", "green"),
                          xlab="Classification", ylab="hemo", main='Hemoglobin')

legend("bottomright", legend=c("ckd", "notckd"), col=c("yellow", "green"), 
       title="Class", fill=c("yellow", "green"), cex=0.8)
```

Vemos que el postasio en media se mantiene bastante cercana a la media de pacientes sanos. Se pueden observar valores outliers en pacientes enfermos. Podemos pensar que el potasio puede ser un indicador donde no quede muy claro si el paciente está sano o no, a no ser de tener un indicador muy alterado.

La Hemoglobina se encuentra más baja que en pacientes sanos. Tenemos algunos valores alterados que, estudiandolos, estarían dentro de los parámetros normales. Igual que algún valor en pacientes sanos que podría dar indicios de enfermedad. Seguramente, estos pacientes no serán determinados por la hemoglobina pero sí por otros parámetros.

Los valores extremos encontradoss en las varibles (mirándolas en su globalidad) son:

```{r}
par(mfrow=c(1,2))
boxplot(datos$pot,main='Potassium')
boxplot(datos$hemo,main='Hemoglobin')

values_pot<-boxplot.stats(datos$pot)$out
cat("Valores extremos de Potassium :",toString(values_pot), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_pot, dnn = "Count values_pot:")  

values_hemo<-boxplot.stats(datos$hemo)$out
cat("Valores extremos de Hemoglobin :",toString(values_hemo), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_hemo, dnn = "Count values_hemo:")
```

En la Hemoglobina vemos que no tenemos valores extremos si miramos la variable en conjunto.

```{r}
par(mfrow=c(1,2))
boxplot(datos$pcv ~ datos$classification,col = c("yellow", "green"), 
                          xlab="Classification", ylab="pcv", main='Packed Cell Volume',)

legend("bottomright", legend=c("ckd", "notckd"), c("yellow", "green"), 
       title="Class", fill=c("yellow", "green"), cex=0.8)

boxplot(datos$wc ~ datos$classification,col = c("yellow", "green"),
                          xlab="Classification", ylab="wc", main='White Blood Cell')

legend("topright", legend=c("ckd", "notckd"), col=c("yellow", "green"), 
       title="Class", fill=c("yellow", "green"), cex=0.8)
```

El volumen de células es muy inferior en pacientes crónicos que en pacientes no crónicos.
Respecto a los glóbulos blancos, la media de pacientes crónicos es muy parecida a la media de pacientes no crónicos. Los valores outliers son característicos de los pacientes crónicos. Por tanto, si no tienen valores muy significativos, será difícil determinar si són crónicos o no. Dependeran también de otros parámetros para acabar de decidir.


Los valores extremos encontradoss en las varibles (mirándolas en su globalidad) son:

```{r}
par(mfrow=c(1,2))
boxplot(datos$pcv,main='Packed Cell Volume')
boxplot(datos$wc,main='White Blood Cell')

values_pcv<-boxplot.stats(datos$pcv)$out
cat("Valores extremos de Packed Cell Volume :",toString(values_pcv), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_pcv, dnn = "Count values_pcv:")  

values_wc<-boxplot.stats(datos$wc)$out
cat("Valores extremos de White Blood Cell :",toString(values_wc), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_wc, dnn = "Count values_wc:")
```



```{r}
par(mfrow=c(1,2))
boxplot(datos$rc ~ datos$classification,col = c("yellow", "green"), 
                          xlab="Classification", ylab="rc", main='Red Blood Cell Count',)

legend("bottomright", legend=c("ckd", "notckd"), c("yellow", "green"), 
       title="Class", fill=c("yellow", "green"), cex=0.8)

boxplot(datos$bu ~ datos$classification,col = c("yellow", "green"),
                          xlab="Classification", ylab="bu", main='Blood Urea')

legend("topright", legend=c("ckd", "notckd"), col=c("yellow", "green"), 
       title="Class", fill=c("yellow", "green"), cex=0.8)
```

Vemos que los valores en pacientes crónicos de glóbulos rojos es inferior y la urea en sangre es más alta.

```{r}
par(mfrow=c(1,2))
boxplot(datos$rc,main='Red Blood Cell Count')
boxplot(datos$bu,main='Blood Urea')

values_rc<-boxplot.stats(datos$rc)$out
cat("Valores extremos de Red Blood Cell Count :",toString(values_rc), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_rc, dnn = "Count values_rc:")  

values_bu<-boxplot.stats(datos$bu)$out
cat("Valores extremos de Blood Urea :",toString(values_bu), "\n")

#contabilizamos cuantos tenemos de cada uno:
table(values_bu, dnn = "Count values_bu:")  
```

Como podemos observar en todos los campos tenemos valores extremos. Como se ha indicado anteriormente, no prescindiremos de ellos ya que pueden aportar información al estudio. En el proceso de limpieza ya se han eliminado los valores que se consideraban fuera del rango o improbables posiblemente debido a una mala introducción de ese dato.

```{r}
summary(datos)
```

Tras el estudio de los diagramas de cajas, observamos, en parámetros generales que:

  * La mayoría de los pacientes tienen una tensión arterial normal.
  * Aproximadamente el 50% de los registros cuentan con valores de glucosa entre 100-150 unidades.
  * Como media los iones de sodio y potasio están en rango.
  * La creatinina muestra en varios registros valores fuera de rango, teniendo 2.152 unidades de media.
  * Un tercio de los pacientes presentan, hipertensión y diabetes.
  * Un 80% de los pacientes, tiene buen apetito y menos del 10% tiene una efermedad cardio-vascular de base.



### **HISTOGRAMAS**

```{r}
#HISTOGRAMAS
#=========================
par(mfrow=c(1,2))
hist(datos$bp,breaks=15,main='Blood Pressure', xlab="bp")
hist(datos$bgr,breaks=15,main='Blood Glucose Random', xlab="bgr")

par(mfrow=c(1,2))
hist(datos$sc,breaks=15,main='Serum Creatinine', xlab="sc")
hist(datos$sod,breaks=15,main='Sodium', xlab="sod")

par(mfrow=c(1,2))
hist(datos$pot,breaks=15,main='Potassium', xlab="pot")
hist(datos$hemo,breaks=15,main='Hemoglobin', xlab="hemo")

par(mfrow=c(1,2))
hist(datos$pcv,breaks=15,main='Packed Cell Volume', xlab="pcv")
hist(datos$wc,breaks=15,main='White Blood Cell', xlab="wc")

par(mfrow=c(1,2))
hist(datos$rc,breaks=15,main='Red Blood Cell Count', xlab="rc")
hist(datos$bu,breaks=15,main='Blood Urea', xlab="bu")

```

Comprobamos cómo se distribuyen los valores de los distintos atributos, y observamos que, solo parte de los registros, tienen valores en un rango normal. El estudio sobre ellos y sus combinaciones nos va a posibilitar clasificar a un paciente con insuficiencia renal crónica.

### **DIAGRAMAS DE BARRAS. vARIABLES CATEGÓRICAS**

```{r}

par(mfrow=c(1,2))
#Specific Gravity
###################

datos$sg<-as.factor(datos$sg)
plot(datos$sg, main="Specific Gravity", ylab="Frecuencia", col=c("gray"))
#Albumin
#############
datos$al<-as.factor(datos$al)
plot(datos$al, main="Albumin", ylab="Frecuencia", col=c("gray"))


par(mfrow=c(1,2))
#Sugar
########

datos$su<-as.factor(datos$su)
plot(datos$su, main="Sugar", ylab="Frecuencia", col=c("gray"))

#Red Blood Cells
################

datos$rbc<-as.factor(datos$rbc)
plot(datos$rbc, main="Red Blood Cells", ylab="Frecuencia", col=c("gray"))

par(mfrow=c(1,2))
#Pus Cell 
#########
plot(datos$pc, main="Pus Cell ", ylab="Frecuencia", col=c("gray"))

#Pus Cell clumps
################
plot(datos$pcc, main="Pus Cell clumps ", ylab="Frecuencia", col=c("gray"))

par(mfrow=c(1,2))
#Bacteria 
#########
plot(datos$ba, main="Bacteria ", ylab="Frecuencia", col=c("gray"))

#Hypertension
################
plot(datos$htn, main="Hypertension ", ylab="Frecuencia", col=c("gray"))


par(mfrow=c(1,2))
#Diabetes Mellitus
#########
plot(datos$dm, main="Diabetes Mellitus", ylab="Frecuencia", col=c("gray"))

#Coronary Artery Disease
########################
plot(datos$cad, main="Coronary Artery Disease", ylab="Frecuencia", col=c("gray"))


par(mfrow=c(1,3))
#.Appetite
#########
plot(datos$appet, main="Appetite", ylab="Frecuencia", col=c("gray"))

#Pedal Edema
############
plot(datos$pe, main="Pedal Edema", ylab="Frecuencia", col=c("gray"))

#Anemia
############
plot(datos$ane, main="Anemia", ylab="Frecuencia", col=c("gray"))
```

Del análisis de los gráficos en relación a las variables cualitativas, observamos:

* Existe un número moderado de pacientes con diabetes.
* Existe un número moderado de pacientes con hipertensión.
* La mayoría de los pacientes no presentan enfermedades coronarias ni anemia.
* Gran parte de los pacientes aseguran tener buen apetito
* Los glóbulos rojos son normales
* No hay presencia de pus ni de bacterias, mayoritariamente
* Mayoritariamente los pacientes no presentan ni anemia ni edema.

# ***4.-Análisis de datos***

## ***4.1-Selección de los grupos de datos que se quieren analizar/comparar (planificación de los análisis a aplicar).***

De entre todos los atributos recogidos en el dataset, los que a priori mejor describen una posible insuficiencia renal crónica es la **creatinina**, valores de la bioquímica básica, como puedan ser rango de iones **sodio-potasio**, y **hematocrito (glóbulos rojos)**. Todos estos valores combinados con los valores que muestran si el paciente tiene **diabetes** e **hipertensión** nos ayudarán a categorizar este tipo de insuficiencia.

Es decir, sabiendo que la creatinina es un valor/factor importante en el diagnóstico de la IRC, intentaremos buscar si existen relaciones o dependencias con los valores típicos de cualquier bioquímica habitual, para poder establecer patrones que sirvan para la detección precoz de la enfermedad.

Estudiaremos principalmente como se distribuyen estas variables para luego profundizar en el estudio y sus relaciones.

* Estadística inferencial de la creatinina para conocer mejor este factor determinante.
* Estudio sobre diferencia de medias (creatinina y diabetes). Intentaremos averiguar si la diabetes tiene un papel importante en los valores de creatinina de los pacientes. 
* Procederíamos de igual modo con la hipertensión regulada también por el riñon.
* Estudio sobre la anemia que es una variable que puede ayudarnos a diagnosticar de forma incipiente la IRC ya que es el riñon, quien regula a través de la eritropoyetina la estimulación de eritrocitos o glóbulos rojos. Estimaremos en este caso modelos de regresión para profundizar en el estudio de la anemia y descubrir qué variables puedan estar más fuertemente relacionadas.


## ***4.2-Comprobación de la normalidad y homogeneidad de la varianza.***

Comprobemos si las variables Serum Creatinine (sc), Sodium (sod), Potassium (pot),Red Blood Cell Count(rc) se distribuyen normalmente.

### **SERUM CREATININE (sc)**

Para comprobar si la variable 'sc' sigue una distribución normal, utilizaremos un test gráfico qqnorm, que dará como resultado una gráfica en la que si los puntos resultantes siguen una línea recta ascendente podremos asumir normalidad.

```{r}
par(mfrow=c(1,2))
plot(density(datos$sc),main="Density")
qqnorm(datos$sc)
```

Parece seguir una línea recta en un rango muy corto  en la parte central del gráfico, por lo que para poder asumir normalidad aplicaremos el test **Shapiro-Wilk Normality**. En este test se plantea como hipótesis nula que la muestra proviene de una población normalmente distribuida. Se rechazará la hipótesis nula si W que es el estadístico del test, es demasiado pequeño (oscila entre 0 y 1). Por otro lado si p-valor es menor que α, se rechazará la hipótesis nula, y los datos no seguirían una distribución normal.

```{r}
shapiro.test(datos$sc)
```

Como p-valor es menor que 0.05, no podemos asumir normalidad.

### **SODIUM (sod)**
```{r}
par(mfrow=c(1,2))
plot(density(datos$sod),main="Density")
qqnorm(datos$sod)
shapiro.test(datos$sod)

```

Como p-valor es menor que 0.05, no podemos asumir normalidad.

### **POTASSIUM (pot)**
```{r}
par(mfrow=c(1,2))
plot(density(datos$pot),main="Density")
qqnorm(datos$pot)
shapiro.test(datos$pot)

```

Como p-valor es menor que 0.05, no podemos asumir normalidad.


### **RED BLOOD CELL Count(rc)**

```{r}
par(mfrow=c(1,2))
plot(density(datos$rc),main="Density")
qqnorm(datos$rc)
shapiro.test(datos$rc)
```

Como p-valor es menor que 0.05, no podemos asumir normalidad.

Por tanto, ninguna de las 3 variables estudiadas nos ha dado normalidad en los datos según el test de Saphiro-Wilk. De todas maneras, que nos haya salido esto no quiere decir que no puedan ser normalizables.Por el teorema del límite central, al tener más de 30 elementos (n > 30) en las observaciones, sea cual sea la distribución de la variable de interés, la distribución de la media muestral será aproximadamente una  normal. Así, podemos aproximar a la normalidad y asumir que tenemos normalidad.

Ahora vamos a comprobar la homocedasticidad en los datos, es decir, la igualdad de las varianzas. Aplicamos el test de Fligner-Killeen entre la hemoglobina y la hipertensión:

```{r}
fligner.test(hemo ~ htn, data = datos)
```

Obtenemos un p-value < 0.05, por tanto, se rechaza la hipótesis nula de homocedasticidad y se concluye que la variable hemo presenta varianzas estadísticamente diferentes grupos que tenemos en htn (es decir, pacientes hipertensos y pacientes no hipertensos).

## ***4.3-Aplicación de pruebas estadísticas para comparar grupos de datos.Aplicad tres métodos de análisis diferentes.***

### **ESTADÍSTICA INFERENCIAL**

Teniendo en cuenta que un intervalo de confianza para un cierto parámetro con un nivel de confianza C%, es un intervalo calculado a partir de una muestra de manera que el procedimiento de cálculo garantiza que el C% de las muestras dan lugar a un intervalo que contiene el valor real del parámetro, procedemos a calcular el intervalo de confianza al 95% de la variable sc (serum creatinine) de los pacientes.

- Calculamos la media de la Creatinina
- La desviación típica
- Fijamos un nivel de confianza (1-$\alpha$)=95%
- Calculamos el error estándar: 

$$
s_x= \frac{s}{\sqrt{n}}
$$
- Calculamos el valor crítico que es el punto $t_{\alpha/2,n-1}$ tal que:

$$
P(t_{n-1}>=t_{\alpha/2,n-1})= \alpha/2
$$

- Calculamos el margen de error:

$$
t_{\alpha/2,n-1}{\frac{s}{\sqrt{n}}}
$$

- Siendo el intervalo de confianza:

$$
(\overline{x}-t_{\alpha/2,n-1}{\frac{s}{\sqrt{n}}},\overline{x}+t_{\alpha/2,n-1}{\frac{s}{\sqrt{n}}})
$$

```{r}
n<-nrow(datos)
me<-mean(datos$sc)
me
s<- sd(datos$sc)
s
t<-qt(0.025,399)
t
es<-s/sqrt(n)
es

i1=me-(t*es)
i2=me+(t*es) 
i1
i2

```

El intervalo de confianza sería **(1.9596,2.3435)**, siendo la media muestral de **2.1516**.

Verificamos con el t-test que hemos realizado bien los cálculos:

```{r}
tt<-t.test( datos$sc, conf.level=0.95 )
tt
```

Si repetimos en un número elevado de muestras el mismo procedimiento, el 95% de los intervalos encontrados contendrán el valor real de la media de la creatinina.

### **CONTRASTE DE HIPOTESIS PARA LA DIFERENCIA DE MEDIAS**

Intentaremos dar respuesta a los siguientes interrogantes:
- ¿Podemos aceptar que los pacientes que tienen diabetes tienen la creatinina más alta que aquellos que no han desarrollado esta enfermedad?(Nivel de confianza del 95%). Aplicaremos un test de t Student. Veamos primero si podemos asumir igualdad de varianzas.

```{r}
sc_condm<- datos$sc[datos$dm=='yes']
sc_sindm<- datos$sc[datos$dm=='no']
var.test(sc_condm,sc_sindm)
```

Observamos un p-valor <0.05 por lo que rechazaríamos la hipotesis nula que implica que no podemos considerar varianzas iguales.

Por lo tanto tendremos que usar un test no paramétrico, el conocido cmo test U de Mann-Whitney que aplicado sobre muestras independientes nos permite comparar sus medias:

La hipótesis nula, $h_0$, recoge el hecho que queremos someter a prueba. Y la hipótesis alternativa, $h_1$, es la que se ofrece como alternativa a la nula.

- $h_0: \mu_1-\mu_2= 0$
- $h_1: \mu_1-\mu_2> 0$

```{r}
wilcox.test(datos$sc~datos$dm,alt="greater")
```

Como p-valor es mayor que 0.05 aceptamos la hipótesis nula, y por tanto no habría diferencias entre las medias de las creatininas de la población con diabetes en relación con aquellos pacientes que no han desarrollado la enfermedad.


### **REGRESIÓN LINEAL**

Estudiaremos la relación entre distintas variables y la identificación de factores de riesgo asociados al desarrollo de una Insuficiencia Renal Crónica.

#### * **GLOBULOS ROJOS~HEMOGLOBINA Y EN DIFERENTES NIVELES DE ALBÚMINA**

Vamos a estimar por mínimos cuadrados ordinarios un modelo lineal que explique la variable que indica el número de glóbulos rojos en función de la hemoglobina.

Representamos una matriz de diagramas de dispersión para comprobarlo gráficamente.

```{r}
pairs(datos$rc~datos$hemo)
```

Estimamos el modelo:

```{r}
#Estimación del modelo

model<- lm(hemo~rc, data=datos)

plot(datos$rc,datos$hemo,xlab="rc", ylab="hemo")
abline(model,col="red")
summary(model)
```

A la vista de los resultados, existe una relación lineal positiva moderada, entre ambas variables. Se observa
que el coeficiente de determinación ajustado es: 0.6517 . Es decir, el **modelo explica el 65.17%** de la variabilidad de la variable hemoglobina.


La relación calculada anteriormente varía dependiendo de la nutrición de cada paciente.Haremos el mismo estudio dividiendo la muestra en 6 partes,1 para cada nivel de albúmina.(Cuanto más se aproxime a 5 el nivel de albúmina presentado, la nutrición del paciente será mejor).

```{r}
#Nivel 0: La Albumin está a 0
#########
al_0 <- which(datos$al==0 )
data_0=datos[al_0,]
dim(data_0)
```

Nivel 0: Obtenemos 245 registros.

```{r}
#Nivel 1:  La Albumin está a 1
#########
al_1 <- which(datos$al==1 )
data_1=datos[al_1,]
dim(data_1)
```
Nivel 1: Obtenemos 44 registros.

```{r}
#Nivel 2: La Albumin está a 2 
#########
al_2 <- which(datos$al==2 )
data_2=datos[al_2,]
dim(data_2)
```

Nivel 2: Obtenemos 43 registros.

```{r}
#Nivel 3: La Albumin está a 3
#########
al_3 <- which(datos$al==3 )
data_3=datos[al_3,]
dim(data_3)
```

Nivel 3: Obtenemos 43 registros.

```{r}
#Nivel 4: La Albumin está a 4
#########
al_4 <- which(datos$al==4 )
data_4=datos[al_4,]
dim(data_4)
```

Nivel 4: Obtenemos 24 registros.

```{r}
#Nivel 5: La Albumin está a 5
#########
al_5 <- which(datos$al==5 )
data_5=datos[al_5,]
dim(data_5)

```

Nivel 5: Obtenemos 1 registro.

Estimamos un modelo para cada subconjunto:

**Modelo Nivel 0 **
```{r}
#Nivel 0
model_0<- lm(hemo~rc, data=data_0)
summary(model_0)  
```

**Modelo Nivel 1 **
```{r}

#Nivel 1
model_1<- lm(hemo~rc, data=data_1)
summary(model_1)
```

**Modelo Nivel 2 **
```{r}
#Nivel 2
model_2<- lm(hemo~rc, data=data_2)
summary(model_2)
```

**Modelo Nivel 3 **
```{r}
#Nivel 3
model_3<- lm(hemo~rc, data=data_3)
summary(model_3)
```

**Modelo Nivel 4 **
```{r}
#Nivel 4
model_4<- lm(hemo~rc, data=data_4)
summary(model_4)
```

**Modelo Nivel 5 **
```{r}
#Nivel 5
model_5<- lm(hemo~rc, data=data_5)
summary(model_5)
```

A la vista de los resultados, podemos concluir que la presencia o no de desnutrición influye ya que los coeficientes de determinación varían aunque se observan valores en torno al 60% en los tres primeros casos (excepto en nivel 4 que obtenemos un 47.38% y en nivel 5 donde no obtenemos nada pues solo tenemos un punto). Se puede observar que la relación lineal en presencia de desnutrición (menor cantidad de albúmina) mejora.

Veámos la relación lineal con los diagramas:
```{r}

par(mfrow=c(1,2))
plot(data_0$rc,data_0$hemo,xlab="rc", ylab="hemo",main = "al=0")
abline(model_0,col = "red")

plot(data_1$rc,data_1$hemo,xlab="rc", ylab="hemo",main = "al=1")
abline(model_1,col = "red")

par(mfrow=c(1,2))
plot(data_2$rc,data_2$hemo,xlab="rc", ylab="hemo",main = "al=2")
abline(model_2,col = "red")

plot(data_3$rc,data_3$hemo,xlab="rc", ylab="hemo",main = "al=3")
abline(model_3,col = "red")

par(mfrow=c(1,2))
plot(data_4$rc,data_4$hemo,xlab="rc", ylab="hemo",main = "al=4")
abline(model_4,col = "red")

plot(data_5$rc,data_5$hemo,xlab="rc", ylab="hemo",main = "al=5")


```


#### * **GLOBULOS ROJOS~HEMOGLOBINA EN PACIENTES NORMOTENSIONADOS O HIPERTENSOS**

Vamos a estudiar ahora la relación de los glóbulos rojos y la hemoglobina en función de si el paciente presenta hipertensión o no. Para ello, creados dos grupos: pacientes sin hipertensión (h_no) y pacientes con hipertensión (h_yes):

```{r}
#Nivel yes: Pacientes con hipertensión
#########
h_yes <- which(datos$htn=="yes")
data_hy=datos[h_yes,]
dim(data_hy)

#Nivel no; Pacientes sin hipertensión
#########
h_no <- which(datos$htn=="no")
data_hn=datos[h_no,]
dim(data_hn)
```

Obtenemos 147 pacientes con hipertensión y 253 pacientes sin hipertensión. Ahora vamos a estudiar en cada caso la linealidad entre globulos rojos y la hemoglobina, ¿la hipertensión afecta? Veámoslo:

**Modelo hemo~rc para hipertensos**
```{r}
model_yes<- lm(hemo~rc, data=data_hy)
summary(model_yes)  
```

**Modelo hemo~rc para No hipertensos**
```{r}
model_no<- lm(hemo~rc, data=data_hn)
summary(model_no)

par(mfrow=c(1,2))
plot(data_hy$rc,data_hy$hemo,xlab="rc", ylab="hemo",main = "Hipertensos")
abline(model_yes,col = "red")

plot(data_hn$rc,data_hn$hemo,xlab="rc", ylab="hemo",main = "No Hipertensos")
abline(model_no,col = "red")
```


A la vista de los resultados, podemos concluir que la presencia o no de hipertensión influye, ya que los coeficientes de determinación varían aunque, se observan valores en torno al 40-50% en ambos casos. Se puede observar que la relación lineal en presencia de hipertensión es mayor.


#### * **GLOBULOS ROJOS~CREATININA EN PACIENTES NORMOTENSIONADOS O HIPERTENSOS**

Hacemos lo mismo que en el apartado anterior pero entre globulos rojos y creatinina. Los grupos de estudios son los mismos, pacientes hipertensos y no hipertensos

```{r}
#Nivel yes: Pacientes con hipertensión
#########
h_yes <- which(datos$htn=="yes")
data_hy=datos[h_yes,]
dim(data_hy)

#Nivel no; Pacientes sin hipertensión
#########
h_no <- which(datos$htn=="no")
data_hn=datos[h_no,]
dim(data_hn)
```

Obtenemos 147 pacientes con hipertensión y 253 pacientes sin hipertensión. Ahora veámos como afecta la hipertensión a la relación entre glóbulos rojos y creatinina:

**Modelo hemo~rc para hipertensos**
```{r}
model_yes_1<- lm(rc~sc, data=data_hy)
summary(model_yes_1)  
```

**Modelo hemo~rc para No hipertensos**
```{r}
model_no_1<- lm(rc~sc, data=data_hn)
summary(model_no_1)
```


```{r}
par(mfrow=c(1,2))
plot(data_hy$rc,data_hy$sc,xlab="rc", ylab="sc",main = "Hipertensos")
abline(model_yes_1,col = "red")

plot(data_hn$rc,data_hn$sc,xlab="rc", ylab="sc",main = "No Hipertensos")
abline(model_no_1,col = "red")
```


Observamos que no existe una relación lineal entre los globulos rojos y la creatinina de un paciente.

Mirando la dispersión en su globalidad (sin realizar grupos) realmente podemos observar que no existía relación:
```{r}
pairs(datos$rc~datos$sc)
```


# ***5.-Representación de los resultados mediante gráficas y tablas.***

De entre las representaciones posibles, implementamos los diagramas de cajas de las variables que hemos comparado.


## * **HEMATOCRITO Y HEMOGLOBINA EN DIFERENTES ESTADOS DE NUTRICIÓN**

```{r}
par(mfrow=c(1,2))
boxplot(datos$hemo ~ datos$al,col = rainbow(length(unique(datos$al))), 
                          xlab="Albunim", ylab="hemo", main='Hemo ~ Albunim',)

legend("topright", legend=c(0, 1, 2, 3, 4, 5), 
       title="Albunim", fill=rainbow(length(unique(datos$al))), cex=0.6, horiz=FALSE)

boxplot(datos$rc ~ datos$al,col = rainbow(length(unique(datos$al))), 
                          xlab="Albunim", ylab="Rc", main='Rc ~ Albunim',)

legend("topright", legend=c(0, 1, 2, 3, 4, 5), 
       title="Albunim", fill=rainbow(length(unique(datos$al))), cex=0.6, horiz=FALSE)
```

Podemos comprobar las variaciones del hematocrito y el número de glóbulos rojos en relación a los diferentes estados de nutrición del paciente.


## * **HEMATOCRITO Y HEMOGLOBINA EN PACIENTES HIPERTENSOS Y AQUELLOS QUE PRESENTAN UNA TENSIÓN NORMAL**

```{r}
par(mfrow=c(1,2))
boxplot(datos$hemo ~ datos$htn,col = rainbow(length(unique(datos$htn))), 
                          xlab="Hipertensión", ylab="hemo", main='Hemo ~ Hipertensión',)

legend("topright", legend=c("no", "yes"), 
       title="Htn", fill=rainbow(length(unique(datos$htn))), cex=0.6, horiz=FALSE)

boxplot(datos$rc ~ datos$htn,col = rainbow(length(unique(datos$htn))), 
                          xlab="Hipertensión", ylab="Rc", main='Rc ~ Hipertensión',)

legend("topright", legend=c("no", "yes"), 
       title="Htn", fill=rainbow(length(unique(datos$htn))), cex=0.6, horiz=FALSE)
```

En general los pacientes hipertensos presentan niveles de hemoglobina y hematocrito peores.

## * **HEMATOCRITO Y CREATININA EN PACIENTES HIPERTENSOS Y AQUELLOS QUE PRESENTAN UNA TENSIÓN NORMAL**

```{r}
par(mfrow=c(1,2))
boxplot(datos$sc ~ datos$htn,col = rainbow(length(unique(datos$htn))), 
                          xlab="Hipertensión", ylab="sc", main='sc ~ Hipertensión',)

legend("top", legend=c("no", "yes"), 
       title="Htn", fill=rainbow(length(unique(datos$htn))), cex=0.6, horiz=FALSE)

boxplot(datos$rc ~ datos$htn,col = rainbow(length(unique(datos$htn))), 
                          xlab="Hipertensión", ylab="Rc", main='Rc ~ Hipertensión',)

legend("topright", legend=c("no", "yes"), 
       title="Htn", fill=rainbow(length(unique(datos$htn))), cex=0.6, horiz=FALSE)


```

Observamos niveles más altos de creatinina en pacientes con hipertensión y como media mayor número de globulos rojos en pacientes normotensionados.

Hemos realizado varios estudios pero vamos a comprobar si tenemos alguna relación entre las variables cuantitativas. Para ello creamos un dataset con solo las variables Cuantitativas:

```{r}
names<-colnames(datos)
idQuantitative <- which(names=="age"| names=="bp" | names=="bgr"| names=="bu" | names=="sc" | names=="sod" | names=="pot" | names=="hemo" | names=="pcv" | names=="wc"  | names=="rc")

data_Quantitive <- datos[,idQuantitative]
head(data_Quantitive)
```

## * **CORRELACIONES** 

Ahora vamos a visualizar la correlación existente entre las varibles para ver si existe alguna relación entre ellas:

```{r}

#Vemos la correlación a partir de un gráfico
chart.Correlation(data_Quantitive)
```

Mirando el diagrama vemos que hemo y pcv (es decir, hemoglobina y porcentaje de células) están fuertemente correlacionadas con un valor de correlación de 0.88. Vemos que las dos variables (hemo y pcv) tienen la misma correlación con la variable rc (hematocrito), que tiene valor 0.81. Por otro lado, otra correlación que destaca es la relación entre sc (creatinina) y bu (urea en sangre) correlacionadas con un 0.79.
Hay otras correlaciones, aunque no tan superiores puede ser la hemoglobina con la creatinina y la urea, o, estas últimas con los hematocritos.

## * **DIABÉTICOS**

Como afecta la diabétes

Vista la relación entre las variables y vista la relación con la hipertensión, veámos qué pasa con la diabetes. 
```{r}
#registos de diabéticos que tenemos en el dataset
barplot(table(datos$dm))

table(datos$dm)

```

En la muestra tenemos menos diabéticos que no diabéticos. Tenemos 263 registros no diabéticos frente a 137 sí diabéticos. Casi tenemos el doble de no que de sí.


```{r}
#Creatinina en diabéticos
boxplot(datos$sc ~ datos$dm + datos$classification,col = c("orange", "yellow"), 
                          xlab="", ylab="sc", main='sc ~ Diabetes')

legend("topright", legend=c("no", "yes"), 
       title="dm", fill=c("orange", "yellow"), cex=0.6, horiz=FALSE)



```

Vemos que los pacientes con la enfermedad crónica pueden ser diabéticos o no. Lo que no ocurre es que, pacientes que no tienen enfermedad en el riñon sean diabéticos. Entonces, en nuestros datos, si eres diabético eres un paciente con enfermedad crónica en el riñón.
Observamos que los pacientes enfermos, al sufrir diabetes, tienen la creatinina alterada y algo más superiores que los pacientes no enfermos. De hecho solo por ser pacientes enfermos, ya tiene más alto la creatinina (lo podemos ver si comparamos no.ckd y no.notckd). 


```{r}
#Hematocritos en Diabéticos
boxplot(datos$rc ~ datos$htn + datos$classification,col = c("orange", "yellow"), 
                          xlab="Diabetes", ylab="rc", main='Rc ~ Diabetes', las = 2)

legend("topright", legend=c("no", "yes"), 
       title="rc", fill=c("orange", "yellow"), cex=0.6, horiz=FALSE)

```

Se puede observar que los pacientes enfermos tienen los hematocritos más bajos que los pacientes sin enfermedad. De hecho, si encima es diabético aún los pueden tener más bajo. 

```{r}
#Hemoglobina en Diabéticos
boxplot(datos$hemo ~ datos$dm + datos$classification, col = c("orange", "yellow"), 
                          xlab="Diabetes", ylab="hemo", main='hemo ~ Diabetes',)

legend("topright", legend=c("no", "yes"), 
       title="hemo", fill=c("orange", "yellow"), cex=0.6, horiz=FALSE)


```

En este caso vemos que la hemoglobina tiene parámetros muy parecidos entre los pacientes con enfermedad crónica, independientemente de si es diabético o no. Sí tenemos diferencia entre los pacientes no diagnosticados y los diagnosticados, los primeros tiene la hemoglobina más alta que los segundos.

Por supuesto la diabetes es un factor de riesgo para la enfermedad crónica. Independientemente vemos que se puede generar la enfermedad sin ser diabético (ya que los parámetros de diabéticos y no diabéticos en pacientes con enfermedad renal se asemejan mucho).

Un parámetro importante en la detección de la enfermedad es la Albúmina veámos cómo se mueve para pacientes diabéticos. Utilizaremos los grupos generados anteriormente: data_0, data_1, data_2, data_3, data_4 y data_5 para localizare el nivel de albúminia (ya que recordemos que tenemos 6 categorías según el nivel de albúminia):

```{r}
par(mfrow=c(1,2))
#Diagrama densidad en los diferentes niveles de albúminia y siendo diabéticos
plot(density(data_0[data_0$dm=="yes","sc"]), col = "blue", ylim = c(0, 0.9), main ="Creatinina en diabéticos")
lines(density(data_1[data_1$dm=="yes","sc"]), col = "green")
lines(density(data_2[data_2$dm=="yes","sc"]), col = "red")
lines(density(data_3[data_3$dm=="yes","sc"]), col = "purple")
lines(density(data_4[data_4$dm=="yes","sc"]), col = "chocolate2")
points(data_5[data_5$dm=="yes","sc"], 0, col="black", cex=1.3, pch=18)
legend("topright", c("al0", "al1", "al2", "al3", "al4", "al5"),
       lty = 1, col = c("blue", "green", "red", "purple", "chocolate2", "black"))

#Diagrama densidad en los diferentes niveles de albúminia y siendo NO diabéticos
plot(density(data_0[data_0$dm=="no","sc"]), col = "blue", ylim = c(0, 1), main ="Creatinina en No diabéticos")
lines(density(data_1[data_1$dm=="no","sc"]), col = "green")
lines(density(data_2[data_2$dm=="no","sc"]), col = "red")
lines(density(data_3[data_3$dm=="no","sc"]), col = "purple")
lines(density(data_4[data_4$dm=="no","sc"]), col = "chocolate2")
#points(data_5[data_5$dm=="no","sc"], 0, col="black", cex=2, pch=18)  #No tenemos punto con no
legend("topright", c("al0", "al1", "al2", "al3", "al4", "al5"),
       lty = 1, col = c("blue", "green", "red", "purple", "chocolate2", "black"))
```

Podemos ver que la albúminia, en el caso de los diabéticos, se distribuye casi igual en nivel 0 y nivel 1 (hay una pequeña subida entre 6 y 8 para nivel 0). Para el resto de casos cada vez se aplana más. Esto es que, cada vez que la albúminia está en un estadio superior la creatinina toma un rango mayor, aumentado su valor máximo. Así por ejemplo en un estadio 4 de albúminia el rango de la creatinina puede variar entre 0 y 10, obteniendo su mayor densidad alrededor de 4 (mientras que en un estadio 0 estamos alrededor de 2).
Por contra partida, si no son diabéticos, la densidad no se aplana aunque tengamos estemos en estadios más altos de albúminia. Tenemos una densidad muy alta en nivel0.



La franja de edad por donde se mueven los diabéticos son:

```{r}
#Gráfica edad diabéticos

ggplot(data = datos,
       mapping = aes(x = age, fill = factor(dm))) +
  geom_histogram(bins = 9, position = 'dodge', alpha = 0.8) +
  labs(title = 'Edad - Diabéticos',
       fill = 'Diabéticos',  x = 'age', y = 'conteos') +
facet_grid(. ~ classification)

```

Nos encontramos diabéticos en casi todas las franjas de edad, pero la franja más afectada es entre los 55 y 70 años, donde los diabéticos se disparan.

## * **ENFERMEDAD CORONARIA**

¿Qué pasa con la enfermedad coronaria?

Igual que hemos hecho con hipertensión y diabetes, veámos ahora esta enfermedad. Veámos si hay alguna relación entre las dos enfermedades respecto a las variables de analítica.

```{r}
#registos de enfermos coronarios que tenemos en el dataset
barplot(table(datos$cad), main = "Distribución Enfermos coronarios", xlab = "Enfermos Coronarios")

table(datos$cad)

```

Tenemos muchísimos más registros que no padecen enfermedad coronaria. De hecho solo la padecen 34 de nuestros pacientes.

La enfermedad coronária puede hacer compotars aumento en la tensión arterial. Veamos de los 34 pacientes que tenemos con enfermedad coronaria cuántos son hipertensos:

```{r}
#Diagrama de Hipertensos entre los pacientes que sufren una enfermedad coronaria 
barplot(table(datos[datos$cad == "yes", ]$htn), main = "Hipertensión en enfermos coronarios", xlab="hipertensión")

#Cantidad
table(datos[datos$cad == "yes", ]$htn)
```

Podemos ver que 30 de los 34 sufren tensión arterial. Segurameente por consecuencia de la enfermedad coronaria.

Veámos ahora cómo tenemos los otros parámetros estudiados dentro de los pacientes con enfermedad coronaria:

```{r}
#Gráfico Hemoglobina en enfermedad coronaria
ggplot(data = datos,
       mapping = aes(x = hemo, fill = factor(cad))) +
  geom_histogram(bins = 9, position = 'dodge', alpha = 0.8) +
  labs(title = 'Hemo - Enf. Coronaria',
       fill = 'Enf. Coronaria',  x = 'hemo', y = 'conteos') +
facet_grid(. ~ classification)

```

Podemos ver que los pacientes que sufren una enfermedad coronaria son pocos y su nivel de hemoglobina no llega a 14 mg/ml. Además, en nuestros datos, solo los pacientes con enfermedad crónica tiene enfermedad coronaria.

```{r}
#Gráfico rc en enfermedad coronaria
ggplot(data = datos,
       mapping = aes(x = sc, fill = factor(cad))) +
  geom_histogram(bins = 9, position = 'dodge', alpha = 0.8) +
  labs(title = 'sc- Enf. Coronaria',
       fill = 'Enf. Coronaria',  x = 'sc', y = 'conteos') +
facet_grid(. ~ classification)

```

Nos vuelve a pasar como con la diabetes, que no tenemos ningún registro que, no siendo un paciente crónico, tengan una enfermedad coronaria, En nuestra muestra no tenemos, por tanto, pacientes no crónicos con alguna enfermedad coronaria. Parace que solo se vean afectados los pacientes crónicos. Así, dichos pacientes son los que tiene valores de creatinina. Vemos que tenemos fluctuación en la creatinina, ya sea un paciente con enfermedad coronaria o no. Con enfermedad coronaria tenemos pocos datos y por eso nos aparecen pocos registros (solo tenemos 34).

```{r}
#Gráfica de Creatinina en enfermos crónicos según tengan o no enfermedad coronária
ggplot(datos[datos$classification=="ckd",], aes(x=sc, color=cad)) +
  geom_density() 
```

Esta gràfica representamos la parte izquierda de la anterior gráfica, es decir, la evolución de la creatinina en los enfermos crónicos según tengan enfermedad coronaria o no (cad es la variable de enfermedad coronaria). Vemos como la Creatinina es más plana en los enfermos con afectación coronaria, mientras que los que no tienen enfermedad coronaria, su creatinina se mantiene más estable entre el 0 y 2.5.

Vamos a visualizar ahora en qué franja de edad nos movemos entre los pacientes crónicos:

```{r}
#Gráfica edad en enfermedad coronaria
ggplot(data = datos,
       mapping = aes(x = age, fill = factor(cad))) +
  geom_histogram(bins = 9, position = 'dodge', alpha = 0.8) +
  labs(title = 'Edad - Enf. Coronaria',
       fill = 'Enf. Coronaria',  x = 'age', y = 'conteos') +
facet_grid(. ~ classification)

```

Los pacientes que sufren una enfermedad coronaria aparecen a partir de los 50 años, además, son todos pacientes crónicos. Así que a partir de dicha edad, puede ser una enfermedad contraída por al enfermedad crónica o puede ser que una enfermedad de este tipo complique la situación en una enfermedad renal. 


# ***6.-Conclusiones.***

Tras el estudio realizado podemos concluir:

* Existe una relación lineal positiva moderada, entre las variables glóbulos rojos y la hemoglobina.
* La relación es más evidente cuando existe un grado de desnutrición en el paciente.

* Si tenemos en cuenta la hipertensión observamos:

  - Relación lineal positiva moderada de las variables rc y hemo
  - Valores mayores de creatinina en pacientes hipertensos.
  - Valores mayores de globulos rojos en pacientes normotensionados

* No habría diferencias entre las medias de las creatininas de la población con diabetes en relación con aquellos pacientes que no han desarrollado la enfermedad.

* Ser diabético hace predisposición o es factor de riesgo, para contraer la enfermedad. La diabetes aumenta los niveles de creatinina y disminuye los niveles de hematorcritos o glóbulos rojo, provocando anemia. Por lo que la diabetes es un factor que puede afectar a la salud del riñón. De todas maneras, no siendo diabético se puede dar que padezcas enfermedad y los parámetros serán muy parecidos a los diabéticos. Mayoritáriamente se encuetra diabétes entre los pacientes con enfermedad en el riñón entre los 50 y 70 años. 

* La enfermedad coronaria comporta una subida de la tensión arterial y por tanto, es factor de riesgo para los pacientes crónicos, sobretodo a partir de los 50 años. 

Como podemos ver:

```{r}
#Gráfica edad en enfermos crónicos
ggplot(data = datos,
       mapping = aes(x = age, fill = factor(classification))) +
  geom_histogram(bins = 9, position = 'identity', alpha = 0.8) +
  labs(title = 'Enfermos crónicos Riñón',
       fill = 'ECR',  x = 'age', y = 'conteos') 
```

Entre los 50 y 75 años es donde se mueve el gran volumen de enfermos crónicos del riñón. Como ya hemos observado, a esas la hipertensión, las enfermedades coronarias y la diabetes suelen ser más más frecuentes. Siendo, dichas enfermedades, un factor que favorece un mal funcionamiento de los riñones y por tanto, provocando la enfermedad crónica del riñón. 

Resumiendo, los enfermos crónicos padecen  creatinina alta, los glóbulos rojos (al igual que los hematocritos), suelen estar bajos:

```{r}
par(mfrow=c(1,2))
#Gráfica edad en enfermos crónicos
ggplot(data = datos,
       mapping = aes(x = sc, fill = factor(classification))) +
  geom_histogram(bins = 9, position = 'identity', alpha = 0.5) +
  labs(title = 'Creatinina: Enfermos crónicos Riñón',
       fill = 'ECR',  x = 'sc', y = 'conteos') 

#Gráfica edad en enfermos crónicos
ggplot(data = datos,
       mapping = aes(x = hemo, fill = datos$classification))+
  geom_histogram(bins = 9, position = 'identity', alpha = 0.5) +
  labs(title = 'Hemoglobina: Enfermos crónicos Riñón',
       fill = 'ECR',  x = 'hemo', y = 'conteos')

```
Una alta urea en sangre (a partir de 50 mg) y una alta glucosa en sangre es determinante, ya que parámetros tan altos son indicadores de disfunción renal.

```{r}
par(mfrow=c(1,2))
#Gráfica edad en enfermos crónicos
ggplot(data = datos,
       mapping = aes(x = bu, fill = factor(classification))) +
  geom_histogram(bins = 9, position = 'identity', alpha = 0.5) +
  labs(title = 'Urea: Enfermos crónicos Riñón',
       fill = 'ECR',  x = 'bu', y = 'conteos') 

#Gráfica edad en enfermos crónicos
ggplot(data = datos,
       mapping = aes(x = bgr, fill = datos$classification))+
  geom_histogram(bins = 9, position = 'identity', alpha = 0.5) +
  labs(title = 'BGR: Enfermos crónicos Riñón',
       fill = 'ECR',  x = 'bgr', y = 'conteos')

```

La diabetes, la hipertensión, la anemia, la enfermedad cardiaca son enfermedades que pueden ayudar a la aparición de la enfermedad crónica renal. Hay que decir que en estos datos, la mayoría que tienen algún tipo de enfermedad son pacientes diagnosticados de enfermedad crónica renal. Seguramente, el ser un paciente crónico puede hacer desarrollar cualquiera de las otras enfermedades. Independientemente, se hecha en falta tener enfermos de diabetes, hipertensión, anemia, enfermedad cardiaca que no hayan desarrollado la enfermedad crónica y, poder así, obtener un mejor análisis de las variaciaciones de unos y otros. En estas circumstancias, es difícil diagnosticar una enfermedad crónica cuando, como hemos visto, resulta que tenemos resultados tan parecidos sean o no diabéticos, hipertensos o presenten una enfermedad cardiaca.

Como ejemplo de lo explicado, ponemos los gráficos de enfermos cardiacos que padecen o no padencen las enfermedades nombradas. Como se puede observar, tenemos, tanto pacientes con enfermedad como pacientes sin enfermedad mueven en el mismo rango:
```{r}
par(mfrow=c(1,3))
#Gráfico Hemoglobina enfermos crónicos con enfermedad coronaria
gg1 <- ggplot(data = datos[datos$classification == 'ckd',],
       mapping = aes(x = hemo, fill = factor(cad))) +
  geom_histogram(bins = 9, position = 'dodge', alpha = 0.8) +
  labs(title = 'Hemo - Enf. Coronaria (enfermos crónicos)',
       fill = 'Enf. Coronaria',  x = 'hemo', y = 'conteos') 

#Gráfico Hemoglobina enfermos crónicos con enfermedad coronaria
gg2 <- ggplot(data = datos[datos$classification == 'ckd',],
       mapping = aes(x = hemo, fill = factor(dm))) +
  geom_histogram(bins = 9, position = 'dodge', alpha = 0.8) +
  labs(title = 'Hemo - Diabeticos (enfermos crónicos)',
       fill = 'Diabeticos',  x = 'hemo', y = 'conteos') 

#Gráfico Hemoglobina enfermos crónicos con enfermedad coronaria
gg3 <- ggplot(data = datos[datos$classification == 'ckd',],
       mapping = aes(x = hemo, fill = factor(htn))) +
  geom_histogram(bins = 9, position = 'dodge', alpha = 0.8) +
  labs(title = 'Hemo - Hipertensos (enfermos crónicos)',
       fill = 'Hipertensos',  x = 'hemo', y = 'conteos') 

grid.arrange(gg1, gg2, gg3, 
          ncol = 2, nrow = 2)
```

Como podemos ver, tengan o no tengan la enfermedad los parámetros son muy parecidos en unos u otros, siendo todos pacientes crónicos.



























